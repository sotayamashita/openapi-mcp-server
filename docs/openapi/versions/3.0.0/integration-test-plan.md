# OpenAPI 3.0.0 結合テスト実装計画

## 1. 概要

OpenAPI 3.0.0スキーマ実装の結合テストを行い、実際のYAMLファイルを解析して正確にパースできることを確認します。これにより、理論的な単体テストだけでなく、実際の使用シナリオでの動作を検証します。

## 2. ディレクトリ構造

```
tests/
├── openapi/
│   ├── fixtures/             # テスト用のOpenAPIサンプルファイル
│   │   └── 3.0.0/            # 3.0.0固有のサンプルファイル
│   │       ├── petstore.yaml
│   │       ├── twitter.yaml
│   │       └── complex-api.yaml
│   │
│   ├── versions/
│   │   └── 3.0.0/
│   │       ├── schemas/      # 既存の単体テスト
│   │       └── integration/  # 新しい結合テスト
│   │           ├── parser.integration.test.ts
│   │           └── schema.integration.test.ts
```

## 3. テストケース

### 3.1 基本的なパーステスト

**ファイル**: `parser.integration.test.ts`

1. **単純なAPIファイルのパース**

   - PetStore APIなどの基本的なスキーマをパースできることを確認
   - 結果のオブジェクト構造が期待通りであることを検証

2. **複雑なAPIファイルのパース**

   - 複雑なデータ構造やネストした参照を含むスキーマをパースできることを確認
   - 大規模なAPIスキーマの処理性能を検証

3. **無効なスキーマ検出**
   - 意図的に破損させたファイルに対して適切なエラーを返すことを確認
   - バージョン不一致や必須フィールド欠落などの一般的な問題を検出できることを検証

### 3.2 スキーマコンポーネント検証

**ファイル**: `schema.integration.test.ts`

1. **参照解決メカニズム**

   - `$ref`を使用した参照が正しく解決されることを確認
   - ローカル参照、相対参照、絶対参照などの各種参照タイプをテスト

2. **シナリオベースのテスト**

   - 実際のユースケースに基づいたテスト（認証フロー、APIリクエスト/レスポンスなど）
   - スキーマの各部分が連携して機能することを確認

3. **OpenAPI 3.0.0固有の機能**
   - `nullable`フィールドの処理
   - `discriminator`の動作
   - `oneOf`、`anyOf`などの複合型の処理

## 4. テスト対象のサンプルファイル

### 4.1 基本サンプル

- **PetStore API**: 基本的なCRUD操作を含む標準的なAPI
- **Twitter API**: より複雑な認証フローとエンドポイントを含むAPI

### 4.2 高度なサンプル

- **複合オブジェクト**: `oneOf`、`anyOf`、`allOf`を使用した複雑な型定義
- **参照重視**: 多数の相互参照を含むスキーマ
- **ディスクリミネータ**: 継承を表現するためのディスクリミネータパターンを使用したAPI

## 5. 実装ステップ

1. **テストディレクトリ構造の作成**

   - 上記のディレクトリ構造を実装

2. **サンプルファイルの収集と配置**

   - オープンソースのOpenAPI 3.0.0サンプルを収集
   - 必要に応じてカスタムサンプルを作成

3. **基本テストの実装**

   - パーサーが各サンプルを読み込めることを確認する基本テスト
   - 期待されるフィールドとプロパティを検証するアサーション

4. **高度なテスト実装**

   - 参照解決の検証
   - 実際のユースケースに基づいたシナリオテスト

5. **エッジケースとエラー処理のテスト**
   - 無効なスキーマに対する堅牢性テスト
   - ハンドリングすべき例外とエラーメッセージの検証

## 6. 成功基準

1. すべてのテストケースが成功すること
2. 実際のOpenAPI 3.0.0スキーマファイルを正確にパースできること
3. 無効なスキーマに対しては明確なエラーが返されること
4. 特に参照解決とOpenAPI 3.0.0固有の機能が正しく動作すること

## 7. 将来の拡張

1. パフォーマンステストの追加
2. より複雑なユースケースのカバレッジ拡大
3. 実際のAPI実装との連携テスト
